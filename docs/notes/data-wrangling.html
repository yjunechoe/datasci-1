<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Katie Schuler">
<meta name="dcterms.date" content="2024-09-10">

<title>Data wrangling – DataSci for Lang &amp; Mind</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../include/webex.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      DataSci for Lang &amp; Mind
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">DataSci for Lang &amp; Mind</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html#resources" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resources</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../index.html#materials" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Materials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html#study-guides" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Study guides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html#problem-sets" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem sets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html#exams" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exams</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html#lab-exercises" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab exercises</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html#schedule" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#materials-from-lecture" id="toc-materials-from-lecture" class="nav-link active" data-scroll-target="#materials-from-lecture">Materials from lecture</a></li>
  <li><a href="#tidy" id="toc-tidy" class="nav-link" data-scroll-target="#tidy"><span class="header-section-number">1</span> Tidy</a>
  <ul class="collapse">
  <li><a href="#welcome-to-the-tidyverse" id="toc-welcome-to-the-tidyverse" class="nav-link" data-scroll-target="#welcome-to-the-tidyverse"><span class="header-section-number">1.1</span> Welcome to the tidyverse</a></li>
  <li><a href="#what-is-tidy-data" id="toc-what-is-tidy-data" class="nav-link" data-scroll-target="#what-is-tidy-data"><span class="header-section-number">1.2</span> What is tidy data?</a></li>
  <li><a href="#functional-programming-with-purrr" id="toc-functional-programming-with-purrr" class="nav-link" data-scroll-target="#functional-programming-with-purrr"><span class="header-section-number">1.3</span> Functional programming with purrr</a></li>
  <li><a href="#modern-data-frames-with-tibble" id="toc-modern-data-frames-with-tibble" class="nav-link" data-scroll-target="#modern-data-frames-with-tibble"><span class="header-section-number">1.4</span> Modern data frames with tibble</a></li>
  </ul></li>
  <li><a href="#import" id="toc-import" class="nav-link" data-scroll-target="#import"><span class="header-section-number">2</span> Import</a>
  <ul class="collapse">
  <li><a href="#reading-data-with-readr" id="toc-reading-data-with-readr" class="nav-link" data-scroll-target="#reading-data-with-readr"><span class="header-section-number">2.1</span> Reading data with readr</a></li>
  <li><a href="#writing-data" id="toc-writing-data" class="nav-link" data-scroll-target="#writing-data"><span class="header-section-number">2.2</span> Writing data</a></li>
  </ul></li>
  <li><a href="#data-transformation" id="toc-data-transformation" class="nav-link" data-scroll-target="#data-transformation"><span class="header-section-number">3</span> Data transformation</a>
  <ul class="collapse">
  <li><a href="#data-transformation-with-dplyr" id="toc-data-transformation-with-dplyr" class="nav-link" data-scroll-target="#data-transformation-with-dplyr"><span class="header-section-number">3.1</span> Data transformation with dplyr</a></li>
  <li><a href="#manipulating-rows" id="toc-manipulating-rows" class="nav-link" data-scroll-target="#manipulating-rows"><span class="header-section-number">3.2</span> Manipulating rows</a></li>
  <li><a href="#manipulating-columns" id="toc-manipulating-columns" class="nav-link" data-scroll-target="#manipulating-columns"><span class="header-section-number">3.3</span> Manipulating columns</a></li>
  <li><a href="#group-and-summarise" id="toc-group-and-summarise" class="nav-link" data-scroll-target="#group-and-summarise"><span class="header-section-number">3.4</span> Group and summarise</a></li>
  <li><a href="#more-advanced" id="toc-more-advanced" class="nav-link" data-scroll-target="#more-advanced"><span class="header-section-number">3.5</span> More advanced</a></li>
  </ul></li>
  <li><a href="#further-reading-and-references" id="toc-further-reading-and-references" class="nav-link" data-scroll-target="#further-reading-and-references"><span class="header-section-number">4</span> Further reading and references</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="data-wrangling.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data wrangling</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Katie Schuler </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 10, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled" title="Acknowledgement">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Acknowledgement
</div>
</div>
<div class="callout-body-container callout-body">
<p>These notes are adapted from <a href="https://r4ds.hadley.nz/data-tidy">Ch 5 Data tidying</a>, <a href="https://r4ds.hadley.nz/data-import">Ch 7 Data import</a> and <a href="https://r4ds.hadley.nz/data-transform">Ch 4 Data transformation</a> in R for Data Science</p>
</div>
</div>
<section id="materials-from-lecture" class="level1 unnumbered">
<h1 class="unnumbered">Materials from lecture</h1>
<ul>
<li>Tuesday: <strong><a href="../slides/data-importing.html">slides</a></strong>, <strong><a href="https://colab.research.google.com/drive/1T4ZdEMSJiMyNdzm5Cg8FHi6JlfUzfrTN?usp=sharing">demo</a></strong>, <strong><a href="https://docs.google.com/spreadsheets/d/1pF5_h-I-3PLA1WWunt3lAjWJLJ5Avu-Om-xMTyaTsgw/edit?usp=sharing">my_chicks.csv</a></strong></li>
<li>Thursday: <strong><a href="../slides/data-transformation.html">slides</a></strong> and <a href="https://colab.research.google.com/drive/1CAR9QPn-imYTmUiUZZixxuLABEG8KR1a?usp=sharing">demo</a></li>
</ul>
</section>
<section id="tidy" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Tidy</h1>
<section id="welcome-to-the-tidyverse" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="welcome-to-the-tidyverse"><span class="header-section-number">1.1</span> Welcome to the tidyverse</h2>
<blockquote class="blockquote">
<p>The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures. ~ <a href="https://www.tidyverse.org/">Tidyverse package docs</a></p>
</blockquote>
<p>The <code>tidyverse</code> collection of packages includes:</p>
<ul>
<li><code>ggplot2</code> - for data visualization</li>
<li><code>dplyr</code> - for data wrangling</li>
<li><code>readr</code> - for reading data</li>
<li><code>tibble</code> - for modern data frames</li>
<li><code>stringr</code>: for string manipulation</li>
<li><code>forcats</code>: for dealing with factors</li>
<li><code>tidyr</code>: for data tidying</li>
<li><code>purrr</code>: for functional programming</li>
<li><code>lubridate</code>: for working with dates and times</li>
</ul>
<p>We load the <code>tidyverse</code> like any other package, with <code>library(tidyverse)</code>. When we do, we will receive a message with (1) a list packages that were loaded and (2) a warning that there are potential conflicts with base R’s <code>stats</code> functions</p>
<ul>
<li>We can resolve conflicts with the <code>::</code> operator, which allows us to specify which package our intended function belongs to as a prefix: <code>stats::filter()</code> or <code>dplyr::filter()</code></li>
</ul>
</section>
<section id="what-is-tidy-data" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="what-is-tidy-data"><span class="header-section-number">1.2</span> What is tidy data?</h2>
<p>The same underlying data can be represented in a table in many different ways; some easier to work with than others. The tidyverse makes use of tidy data principles to make datasets easier to work with in R. <strong>Tidy data</strong> provides a standard way of structuring datasets:</p>
<ol type="1">
<li>each variable forms a <strong>column</strong>; each column forms a variable</li>
<li>each observation forms a <strong>row</strong>; each row forms an observation</li>
<li>value is a <strong>cell</strong>; each cell is a single value</li>
</ol>
<p>Why is tidy data easier to work with?</p>
<ul>
<li>Because consistency and uniformity are very helpful when programming</li>
<li>Variables as columns works well for vectorized languages (R!)</li>
</ul>
</section>
<section id="functional-programming-with-purrr" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="functional-programming-with-purrr"><span class="header-section-number">1.3</span> Functional programming with purrr</h2>
<blockquote class="blockquote">
<p>purrr enhances R’s functional programming (FP) toolkit by providing a complete and consistent set of tools for working with functions and vectors. If you’ve never heard of FP before, the best place to start is the family of map() functions which allow you to replace many for loops with code that is both more succinct and easier to read. ~ <a href="https://purrr.tidyverse.org/">purrr docs</a></p>
</blockquote>
<p>Let’s illustrate the joy of the tidyverse with one of its packages: <code>purrr</code>. The docs say that the best place to start is the family of <code>map()</code> functions, so we’ll do that.</p>
<p>The <code>map()</code> functions:</p>
<ol type="1">
<li>take a vector as input</li>
<li>apply a function to each element</li>
<li>return a new vector</li>
</ol>
<p>We say “functions” because there are 5, the generic <code>map()</code> function and <code>map_*()</code> variants for each type of vector:</p>
<ul>
<li><code>map()</code></li>
<li><code>map_lgl()</code></li>
<li><code>map_int()</code></li>
<li><code>map_dbl()</code></li>
<li><code>map_chr()</code></li>
</ul>
<p>To illustrate, suppose we have a data frame <code>df</code> with 3 columns and we want to compute the mean of each column. We could solve this with copy-and-paste (run <code>mean()</code> 3 different times) or try to use a <code>for</code> loop, but <code>map()</code> can do this with just one line:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use `map_dbl()` because `mean()` returns a *double* value</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(df, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="modern-data-frames-with-tibble" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="modern-data-frames-with-tibble"><span class="header-section-number">1.4</span> Modern data frames with tibble</h2>
<blockquote class="blockquote">
<p>A tibble, or tbl_df, is a modern reimagining of the data.frame, keeping what time has proven to be effective, and throwing out what is not. Tibbles are data.frames that are lazy and surly: they do less and complain more ~ <a href="https://tibble.tidyverse.org/">tibble docs</a></p>
</blockquote>
<p>Tibbles do less than data frames, in a good way:</p>
<ul>
<li>never changes type of input (never converts strings to factors!)</li>
<li>never changes the name of variables</li>
<li>only recycles vectors of length 1</li>
<li>never creates row names</li>
</ul>
<p>You can read more in the <a href="https://tibble.tidyverse.org/articles/tibble.html">tibble vignette</a> if you are interested, but understanding these differences is not necessary to be successful in the course. The take-away is that <code>data.frame</code> and <code>tibble</code> sometimes behave differently. The behavior of <code>tibble</code> makes more sense for modern data science, so we should us it instead!</p>
<p>Create a <code>tibble</code> with one of the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) coerce an existing object (e.g., a data frame) to tibble</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(x)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) construct a tibble from a column of vectors</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y=</span><span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># (3) define row-by-row, short for transposed tibble</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>x, <span class="sc">~</span>y, <span class="sc">~</span>z,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a"</span>, <span class="dv">2</span>, <span class="fl">3.6</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"b"</span>, <span class="dv">1</span>, <span class="fl">8.5</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will encounter two main ways tibbles and data frames differ:</p>
<ul>
<li><strong>printing</strong> - by default, tibbles print the first 10 rows and all columns that fit on screen, making it easier to work with large datasets. Tibbles also report the type of each column (e.g.&nbsp;<code>&lt;dbl&gt;</code>, <code>&lt;chr&gt;</code>)</li>
<li><strong>subsetting</strong> - tibbles are more strict than data frames, which fixes two quirks we encountered last lecture when subsetting with <code>[[</code> and <code>$</code>: (1) tibbles <em>never</em> do partial matching, and (2) they <em>always</em> generate a warning if the column you are trying to extract does not exist.</li>
</ul>
<p>To test if something is a <code>tibble</code> or a <code>data.frame</code>:</p>
<ul>
<li><code>is_tibble(x)</code></li>
<li><code>is.data.frame(x)</code></li>
</ul>
</section>
</section>
<section id="import" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Import</h1>
<p>Often we want to read in some data we’ve generated or collected outside of R. The most basic and common format is plain-text <strong>rectangular</strong> files. We will “read” these into R with the <code>readr</code> package.</p>
<section id="reading-data-with-readr" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="reading-data-with-readr"><span class="header-section-number">2.1</span> Reading data with readr</h2>
<blockquote class="blockquote">
<p>The goal of readr is to provide a fast and friendly way to read rectangular data from delimited files, such as comma-separated values (CSV) and tab-separated values (TSV). It is designed to parse many types of data found in the wild, while providing an informative problem report when parsing leads to unexpected results.</p>
<p><a href="https://readr.tidyverse.org/">readr docs</a></p>
</blockquote>
<p>We will use <code>readr</code>’s <code>read_*()</code> functions to read in our rectangular data files.</p>
<p>The <code>read_*()</code> functions have two important arguments:</p>
<ul>
<li><code>file</code> - the path to the file (that reader will try to parse)</li>
<li><code>col_types</code> - <strong>column specification</strong>, a description of how each column should be converted from a character vector to a specific data type</li>
</ul>
<p>There are 7 supported file types, each with their own <code>read_*()</code> function:</p>
<ul>
<li><code>read_csv()</code>: comma-separated values (CSV)</li>
<li><code>read_tsv()</code>: tab-separated values (TSV)</li>
<li><code>read_csv2()</code>: semicolon-separated values</li>
<li><code>read_delim()</code>: delimited files (CSV and TSV are important special cases)</li>
<li><code>read_fwf()</code>: fixed-width files</li>
<li><code>read_table()</code>: whitespace-separated files</li>
<li><code>read_log()</code>: web log files</li>
</ul>
<p>To read <code>.csv</code> files, include a path and (optionally) a column specification in <code>col_types</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) pass only the path; readr guesses col_types </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="at">file=</span><span class="st">'path/to/file.csv'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (2) include a column specification with col_types</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file=</span><span class="st">'path/to/file.csv'</span>, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">list</span>( <span class="at">x =</span> <span class="fu">col_string</span>(), <span class="at">y =</span> <span class="fu">col_skip</span>() )</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With no column specification, <code>readr</code> uses the the first 1000 rows to guess with a simple heuristic:</p>
<ul>
<li>if column contains only T/F, <code>logical</code></li>
<li>if only numbers, <code>double</code></li>
<li>if ISO8601 standard, <code>date</code> or <code>date-time</code></li>
<li>otherwise <code>string</code></li>
</ul>
<p>There are 11 column types that can be specified:</p>
<ul>
<li><code>col_logical()</code> - reads as boolean TRUE FALSE values</li>
<li><code>col_integer()</code> - reads as integer</li>
<li><code>col_double()</code> - reads as double</li>
<li><code>col_number()</code> - numeric parser that can ignore non-numbers</li>
<li><code>col_character()</code> - reads as strings</li>
<li><code>col_factor(levels, ordered = FALSE)</code> - creates factors</li>
<li><code>col_datetime(format = "")</code> - creates date-times</li>
<li><code>col_date(format = "")</code> - creates dates</li>
<li><code>col_time(format = "")</code> - creates times</li>
<li><code>col_skip()</code> - skips a column</li>
<li><code>col_guess()</code> - tries to guess the column</li>
</ul>
<p>Some useful additional arguments:</p>
<ul>
<li>if there is <strong>no header</strong> (the top row containing column names), include <code>col_names = FALSE</code></li>
<li>to <strong>provide a header</strong>, include <code>col_names = c("x","y","z")</code></li>
<li>to <strong>skip some lines</strong>, include <code>skip = n</code>, where n is number of lines to skip</li>
<li>to <strong>select which columns</strong> to import, include <code>col_select(x, y)</code></li>
<li>to <strong>guess</strong> column types <strong>with all rows</strong>, include <code>guess_max = Inf</code></li>
</ul>
<p>Sometimes weird things happen. The most common problems are:</p>
<ul>
<li><strong>column contains unexpected values</strong> - your dataset has a column that you expected to be <code>logical</code> or <code>double</code>, but there is a typo somewhere, so R has coerced the column into <code>character</code>. Solve by specifying the column type <code>col_double()</code> and then using the <code>problems()</code> function to see where R failed.</li>
<li><strong>missing values are not <code>NA</code></strong> - your dataset has missing values, but they were not coded as <code>NA</code> as R expects. Solve by adding an <code>na</code> argument (e.g.&nbsp;<code>na=c("N/A")</code>)</li>
<li><strong>column names have spaces</strong> - your dataset has column names that include spaces, breaking R’s naming rules. In these cases, R adds backticks (e.g.&nbsp;<code>`brain size`</code>); we can use the <code>rename()</code> function to fix them. If we have a lot to rename and that gets annoying, see <code>janitor::clean_names()</code>.</li>
</ul>
<p>Reading more complex file types requires functions outside the tidyverse:</p>
<ul>
<li><strong>excel</strong> with <code>readxl</code> - see <a href="https://r4ds.hadley.nz/spreadsheets#excel">Spreadsheets</a> in R for Data Science</li>
<li><strong>google sheets</strong> with <code>googlesheets4</code> - see <a href="https://r4ds.hadley.nz/spreadsheets#google-sheets">Spreadsheets</a> in R for Data Science</li>
<li><strong>databases</strong> with <code>DBI</code> - see <a href="https://r4ds.hadley.nz/databases">Databases</a> in R for Data Science</li>
<li><strong>json data</strong> with <code>jsonlite</code> - see <a href="https://r4ds.hadley.nz/rectangling">Hierarchical data</a> in R for Data Science</li>
</ul>
</section>
<section id="writing-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="writing-data"><span class="header-section-number">2.2</span> Writing data</h2>
<p>We can also write to a csv file with <code>readr</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(our_tibble, <span class="st">"name_of_file.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We pass the name of our tibble and the name of the file as arguments. In Google Colab, files we write appear in the left side bar file menu.</p>
</section>
</section>
<section id="data-transformation" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data transformation</h1>
<p>Why do we need to transform data?</p>
<blockquote class="blockquote">
<p>Visualization is an important tool for generating insight, but it’s rare that you get the data in exactly the right form you need to make the graph you want. Often you’ll need to create some new variables or summaries to answer your questions with your data, or maybe you just want to rename the variables or reorder the observations to make the data a little easier to work with.</p>
</blockquote>
<section id="data-transformation-with-dplyr" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="data-transformation-with-dplyr"><span class="header-section-number">3.1</span> Data transformation with dplyr</h2>
<p>All <code>dplyr</code> functions (verbs) share a common structure:</p>
<ul>
<li>1st argument is always a data frame</li>
<li>Subsequent arguments typically describe which columns to operate on (via their names)</li>
<li>Output is always a new data frame</li>
</ul>
<p>We can group <code>dplyr</code> functions based on what they operate on:</p>
<ul>
<li>rows - see section 3 Manipulating rows</li>
<li>columns - see section 4 Manipulating columns</li>
<li>groups - see section 5 Grouping and summarizing data frames</li>
<li>tables - see section 6 Joining data frames</li>
</ul>
<p>We can easily combine <code>dplyr</code> functions to solve complex problems:</p>
<ul>
<li>The pipe operator, <code>|&gt;</code> takes the output from one function and passes it as input (the first argument) to the next function.</li>
<li>There is another version of the pipe, <code>%&gt;%</code>. See the reading on data transformation if you are curious about the difference.</li>
</ul>
<p><em>In lecture, we will demonstrate with the 3 most common <code>dplyr</code> functions for manipulating rows, manipulating columns, and grouping. But you should feel comfortable reading the docs/resources to use others to solve unique problems.</em></p>
</section>
<section id="manipulating-rows" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="manipulating-rows"><span class="header-section-number">3.2</span> Manipulating rows</h2>
<p><strong><code>filter()</code></strong> filters rows, allowing you to keep only some rows based on the values of the columns.</p>
<ul>
<li>the first argument is a data frame (all dplyr verbs)</li>
<li>subsequent arguments are the conditions that must be true to keep the row (using R’s logical and comparison operators we learned in <a href="../notes/r-basics.html">R basics</a>!), e.g.&nbsp;<code>filter(age &gt; 18)</code></li>
<li>a common filtering mistake is to use <code>=</code> instead of the logical operator <code>==</code>!</li>
</ul>
<p><strong><code>arrange()</code></strong> arranges the rows in the order you specify based on column values (does not change the number of rows, just changes their order)</p>
<ul>
<li>the first argument is a data frame (all dplyr verbs)</li>
<li>subsequent arguments are a set of column names to order by</li>
<li>note that the default order is ascending, but you can specify descending by wrapping the column in the <code>desc()</code> function</li>
</ul>
<p><strong><code>distinct()</code></strong> finds unique rows in a dataset, but you can also provide column names</p>
<ul>
<li>the first argument is a data frame</li>
<li>optionally subsequent arguments provides column names to find the distinct combination of some variables</li>
<li>note that if you provide column names, distinct will only return those columns unless you add the argument <code>.keep_all=TRUE</code></li>
</ul>
</section>
<section id="manipulating-columns" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="manipulating-columns"><span class="header-section-number">3.3</span> Manipulating columns</h2>
<p><strong><code>mutate()</code></strong> adds new columns that are calculated from existing columns</p>
<ul>
<li>first argument is a data frame (all dplyr verbs)</li>
<li>subsequent arguments are the new column name, an equals sign, followed by an expression you want to use to calculate the new value, e.g.&nbsp;<code>difference=age_end - age_start</code></li>
<li>by default new columns are added to the right, but the <code>.before</code> and <code>.after</code> arguments allows you to add them before/after specific positions (by position number, e.g.&nbsp;<code>.before=1</code> or by column name, e.g.&nbsp;<code>before=age</code>)</li>
</ul>
<p><strong><code>select()</code></strong> selects columns based on their names</p>
<ul>
<li>first argument is a data frame (all dplyr verbs)</li>
<li>subsequent arguments can be the names of the columns you want to keep</li>
<li>use the <code>:</code> operator to select everything from one column to another, e.g.&nbsp;<code>age:height</code></li>
<li>you can also use logical operators like <code>&amp;</code> (and) or <code>!</code> (not) to identify the subset of columns you want to select, e.g.&nbsp;<code>!age:height</code></li>
<li>you can also rename columns within select by putting the name of the column and an equals sign before the column you want to select, e.g.&nbsp;<code>new_name=selected_column</code></li>
</ul>
<p><strong><code>rename()</code></strong> we’ve already seen this function when importing data. Rename is used when want to keep all of our columns but rename one or more.</p>
<ul>
<li>first argument is a data frame (all dplyr verbs)</li>
<li>subsequent arguments are the columns we would like to rename, e.g.&nbsp;<code>new_colname=old_colname</code></li>
</ul>
</section>
<section id="group-and-summarise" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="group-and-summarise"><span class="header-section-number">3.4</span> Group and summarise</h2>
<p>In addition to manipulating rows and columns in your dataset, <code>dplyr</code> also allows you to work with groups</p>
<p><strong><code>group_by()</code></strong> is used to divide your dataset into groups that are meaningful for your analysis.</p>
<ul>
<li><code>group_by()</code> doesn’t change the data, but adds a groups attribute, which tells R that subsequent operations will be performed by group</li>
<li>you can tell if a data frame is grouped by the first line of the output (or with <code>attributes()</code>!)</li>
</ul>
<p><strong><code>summarise()</code></strong> is often used after <code>group_by()</code> to calculate summary statistics on grouped data, which returns a data frame with a single row for each group</p>
<ul>
<li>you can add any number of summary stats; usually you want to name them something that makes sense for your analysis<br>
</li>
<li><code>n()</code> is a particularly useful summary stat to add to <a href="../notes/r-basics.html#built-in-functions">our list</a> that returns a count</li>
<li>use the argument <code>na.rm=TRUE</code> to compute the summary statistics with NAs removed (remember they are contageous!)</li>
<li>note that the returned data frame is iteself grouped, but in a <a href="https://r4ds.hadley.nz/data-transform#grouping-by-multiple-variables">quirky way</a>, with one fewer group (you may get a warning about this). You can add the argument <strong><code>.groups="drop"</code></strong> to drop all groups or <strong><code>.groups="keep"</code></strong> to keep them all</li>
<li>to avoid this quirk, <code>summarise()</code> also has a cool new <strong><code>.by</code></strong> argument that can be used <strong>instead of calling <code>group_by()</code></strong>, which always returns an ungrouped data frame.</li>
</ul>
<p><strong><code>ungroup()</code></strong> is used to remove the grouping attribute from a data frame</p>
</section>
<section id="more-advanced" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="more-advanced"><span class="header-section-number">3.5</span> More advanced</h2>
<p>There are a few more advanced techniques for transforming and tidying data that we won’t cover now, but might be useful to you in your own research.</p>
<ul>
<li><strong>joins</strong> - sometimes you have more than one dataset that you want to join into one. <code>dplyr</code> also has functions for handling that. <a href="https://r4ds.hadley.nz/joins">Learn more about joins</a></li>
<li><strong>pivots</strong> - sometimes your data doesn’t arrive in the tidy data form. The <code>tidyr</code> package can help with <code>pivot_longer()</code> and <code>pivot_wider()</code>. <a href="https://r4ds.hadley.nz/data-tidy">Learn more about pivots</a></li>
</ul>
</section>
</section>
<section id="further-reading-and-references" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Further reading and references</h1>
<p>Recommended further reading:</p>
<ul>
<li><a href="https://r4ds.hadley.nz/data-tidy">Data tidying</a> in R for Data Science</li>
<li><a href="https://r4ds.had.co.nz/tibbles.html">Tibbles</a> in R for Data Science</li>
<li><a href="https://r4ds.hadley.nz/data-import.html">Data import</a> in R for Data Science</li>
<li><a href="https://rstudio.github.io/cheatsheets/html/data-import.html?_gl=1*1fxlvya*_ga*MTI4NTg4NDIzMy4xNjkyODg0OTA4*_ga_2C0WZ1JHG0*MTY5Mjg4NDkwNy4xLjAuMTY5Mjg4NDkwNy4wLjAuMA..">readr cheatsheet</a></li>
<li><a href="https://r4ds.hadley.nz/data-transform">Ch 4 Data transformation</a> in R for Data Science textbook</li>
</ul>
<p>Other references:</p>
<ul>
<li><a href="https://r4ds.hadley.nz/joins">Ch 20 Joins</a> in R for Data Science textbook</li>
<li><a href="https://r4ds.hadley.nz/data-tidy">Ch 6 Data tidying</a> in R for Data Science textbook</li>
</ul>


</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>